# erp-web - æ¶æ„è®¾è®¡

> **æœ€åæ›´æ–°**: 2025-12-01

## ğŸ“Š é¡¹ç›®æ¦‚è¿°

erp-web æ˜¯åŸºäº React 18 + å¾®å‰ç«¯æ¶æ„çš„ä¼ä¸šçº§ ERP å‰ç«¯åº”ç”¨ï¼Œé‡‡ç”¨ Monorepo ç®¡ç†å¤šä¸ªå­åº”ç”¨ï¼Œæ”¯æŒæ¨¡å—åŒ–å¼€å‘å’Œç‹¬ç«‹éƒ¨ç½²ã€‚

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    erp-web (Monorepo)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  packages/                                             â”‚
â”‚  â”œâ”€â”€ main/           â† ä¸»åº”ç”¨ (æ ¸å¿ƒå›¢é˜Ÿç»´æŠ¤)            â”‚
â”‚  â”œâ”€â”€ customer/       â† å®¢æˆ·ç®¡ç†å­åº”ç”¨ (å¾…åˆ›å»º)          â”‚
â”‚  â””â”€â”€ order/          â† è®¢å•ç®¡ç†å­åº”ç”¨ (å¾…åˆ›å»º)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¾®å‰ç«¯æ¶æ„ (Wujie)

```mermaid
graph TB
    Main[Main App<br/>ä¸»åº”ç”¨]
    Customer[Customer App<br/>å®¢æˆ·ç®¡ç†]
    Order[Order App<br/>è®¢å•ç®¡ç†]
    
    Main -->|åŠ è½½| Customer
    Main -->|åŠ è½½| Order
    
    Main -->|å…±äº«| SharedLib[å…±äº«ç»„ä»¶åº“]
    Customer -.->|ä½¿ç”¨| SharedLib
    Order -.->|ä½¿ç”¨| SharedLib
```

---

## ğŸ’» æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **æ ¸å¿ƒ** | React | 18.2+ | UI æ¡†æ¶ |
| | TypeScript | 5.2+ | ç±»å‹ç³»ç»Ÿ |
| | Vite | 5.0+ | æ„å»ºå·¥å…· |
| **è·¯ç”±** | React Router | 6.20+ | è·¯ç”±ç®¡ç† |
| **çŠ¶æ€** | Zustand | 4.4+ | çŠ¶æ€ç®¡ç† |
| **UI** | Ant Design | 5.12+ | ç»„ä»¶åº“ |
| | Less | 4.2+ | CSS é¢„å¤„ç† |
| **å·¥å…·** | Axios | 1.6+ | HTTP å®¢æˆ·ç«¯ |
| | Day.js | 1.11+ | æ—¥æœŸå¤„ç† |
| **å¾®å‰ç«¯** | Wujie | - | å¾®å‰ç«¯æ¡†æ¶ |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
erp-web/
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ main/                    # ä¸»åº”ç”¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ App.tsx          # æ ¹ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ main.tsx         # å…¥å£æ–‡ä»¶
â”‚       â”‚   â”œâ”€â”€ router/          # è·¯ç”±é…ç½®
â”‚       â”‚   â”‚   â””â”€â”€ index.tsx
â”‚       â”‚   â”œâ”€â”€ features/        # åŠŸèƒ½æ¨¡å—
â”‚       â”‚   â”‚   â”œâ”€â”€ auth/
â”‚       â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚       â”‚   â”‚   â”œâ”€â”€ customer/
â”‚       â”‚   â”‚   â”œâ”€â”€ order/
â”‚       â”‚   â”‚   â””â”€â”€ ...
â”‚       â”‚   â”œâ”€â”€ components/      # é€šç”¨ç»„ä»¶
â”‚       â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚       â”‚   â”‚   â”œâ”€â”€ ListPage.tsx
â”‚       â”‚   â”‚   â””â”€â”€ AuthGuard.tsx
â”‚       â”‚   â”œâ”€â”€ api/             # API æ¥å£
â”‚       â”‚   â”‚   â”œâ”€â”€ request.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚       â”‚   â”‚   â””â”€â”€ ...
â”‚       â”‚   â”œâ”€â”€ store/           # å…¨å±€çŠ¶æ€
â”‚       â”‚   â”‚   â””â”€â”€ user.ts
â”‚       â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚       â”‚   â”œâ”€â”€ styles/          # å…¨å±€æ ·å¼
â”‚       â”‚   â”‚   â”œâ”€â”€ theme.less
â”‚       â”‚   â”‚   â””â”€â”€ global.less
â”‚       â”‚   â””â”€â”€ types/           # ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ public/              # é™æ€èµ„æº
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ vite.config.ts       # Vite é…ç½®
â”‚       â””â”€â”€ tsconfig.json
â”œâ”€â”€ pnpm-workspace.yaml          # Monorepo é…ç½®
â”œâ”€â”€ package.json                 # æ ¹é¡¹ç›®é…ç½®
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ nginx.conf                   # Nginx é…ç½®
â””â”€â”€ docker-compose.prod.yml
```

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡

### 1. è·¯ç”±è®¾è®¡

```typescript
// router/index.tsx
const routes = [
  {
    path: '/',
    element: <Layout />,
    children: [
      { path: '', element: <Dashboard /> },
      { path: 'customers', element: <CustomerList /> },
      { path: 'orders', element: <OrderList /> },
      { path: 'projects', element: <ProjectList /> },
      // ...
    ],
  },
  {
    path: '/login',
    element: <Login />,
  },
];

export default function Router() {
  return useRoutes(routes);
}
```

### 2. çŠ¶æ€ç®¡ç† (Zustand)

```typescript
// store/user.ts
import { create } from 'zustand';

interface UserState {
  user: User | null;
  token: string | null;
  setUser: (user: User) => void;
  setToken: (token: string) => void;
  logout: () => void;
}

export const useUserStore = create<UserState>((set) => ({
  user: null,
  token: localStorage.getItem('token'),
  setUser: (user) => set({ user }),
  setToken: (token) => {
    localStorage.setItem('token', token);
    set({ token });
  },
  logout: () => {
    localStorage.removeItem('token');
    set({ user: null, token: null });
  },
}));
```

### 3. API è¯·æ±‚å°è£…

```typescript
// api/request.ts
import axios from 'axios';
import { useUserStore } from '@/store/user';

const request = axios.create({
  baseURL: '/api',
  timeout: 10000,
});

// è¯·æ±‚æ‹¦æˆªå™¨ - æ·»åŠ  Token
request.interceptors.request.use((config) => {
  const token = useUserStore.getState().token;
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// å“åº”æ‹¦æˆªå™¨ - ç»Ÿä¸€é”™è¯¯å¤„ç†
request.interceptors.response.use(
  (response) => response.data,
  (error) => {
    if (error.response?.status === 401) {
      useUserStore.getState().logout();
      window.location.href = '/login';
    }
    return Promise.reject(error);
  },
);

export default request;
```

### 4. ç»„ä»¶è®¾è®¡åŸåˆ™

**ç»„ä»¶åˆ†ç±»**:
- **Page Components** - é¡µé¢çº§ç»„ä»¶ (`features/*/`)
- **Layout Components** - å¸ƒå±€ç»„ä»¶ (`components/Layout/`)
- **Common Components** - é€šç”¨ç»„ä»¶ (`components/`)

**è®¾è®¡åŸåˆ™**:
```typescript
// âœ… å‡½æ•°ç»„ä»¶ + TypeScript
interface Props {
  title: string;
  onSubmit: (data: FormData) => void;
}

export default function MyComponent({ title, onSubmit }: Props) {
  const [value, setValue] = useState('');
  
  return (
    <div>
      <h1>{title}</h1>
      { /* ... */ }
    </div>
  );
}
```

### 5. æ ·å¼æ–¹æ¡ˆ

**Less + CSS Modules**:

```less
// MyComponent.module.less
@import '@/styles/variables.less';

.container {
  padding: @spacing-md;
  
  .title {
    font-size: @font-size-lg;
    color: @primary-color;
  }
}
```

```typescript
// MyComponent.tsx
import styles from './MyComponent.module.less';

export default function MyComponent() {
  return (
    <div className={styles.container}>
      <h1 className={styles.title}>Title</h1>
    </div>
  );
}
```

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### è®¤è¯æ¨¡å— (Auth)

**åŠŸèƒ½**:
- ç™»å½• / ç™»å‡º
- Token ç®¡ç†
- è·¯ç”±å®ˆå«

```typescript
// components/AuthGuard.tsx
export default function AuthGuard({ children }: PropsWithChildren) {
  const token = useUserStore((state) => state.token);
  const location = useLocation();
  
  if (!token) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }
  
  return <>{children}</>;
}
```

### å¸ƒå±€æ¨¡å— (Layout)

**ç»„ä»¶ç»“æ„**:
```
Layout
â”œâ”€â”€ Header (é¡¶éƒ¨å¯¼èˆª)
â”œâ”€â”€ Sidebar (ä¾§è¾¹èœå•)
â””â”€â”€ Content (å†…å®¹åŒºåŸŸ)
```

### åˆ—è¡¨é¡µé¢é€šç”¨ç»„ä»¶

```typescript
// components/ListPage.tsx
interface ListPageProps<T> {
  columns: ColumnsType<T>;
  fetchData: (params: any) => Promise<{ data: T[]; total: number }>;
  createForm?: ReactNode;
  editForm?: ReactNode;
}

export default function ListPage<T>({ columns, fetchData }: ListPageProps<T>) {
  // ç»Ÿä¸€çš„åˆ—è¡¨é¡µé€»è¾‘ï¼š
  // - æ•°æ®åŠ è½½
  // - åˆ†é¡µ
  // - æœç´¢
  // - æ–°å¢/ç¼–è¾‘/åˆ é™¤
}
```

---

## ğŸ“¦ æ„å»ºä¼˜åŒ–

### Vite é…ç½®

```typescript
// vite.config.ts
export default defineConfig({
  plugins: [react()],
  
  resolve: {
    alias: {
      '@': '/src',
    },
  },
  
  css: {
    preprocessorOptions: {
      less: {
        javascriptEnabled: true,
        modifyVars: {
          '@primary-color': '#1890ff',
        },
      },
    },
  },
  
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'vendor-react': ['react', 'react-dom', 'react-router-dom'],
          'vendor-antd': ['antd', '@ant-design/icons'],
        },
      },
    },
  },
});
```

### ä»£ç åˆ†å‰²

```typescript
// è·¯ç”±æ‡’åŠ è½½
const CustomerList = lazy(() => import('@/features/customer/List'));

<Suspense fallback={<Spin />}>
  <Routes>
    <Route path="/customers" element={<CustomerList />} />
  </Routes>
</Suspense>
```

---

## ğŸ¨ UI è®¾è®¡è§„èŒƒ

### ä¸»é¢˜å˜é‡

```less
// styles/variables.less
@primary-color: #1890ff;
@link-color: #1890ff;
@success-color: #52c41a;
@warning-color: #faad14;
@error-color: #f5222d;

@font-size-base: 14px;
@font-size-lg: 16px;
@font-size-sm: 12px;

@spacing-xs: 4px;
@spacing-sm: 8px;
@spacing-md: 16px;
@spacing-lg: 24px;
```

### ç»„ä»¶è§„èŒƒ

- æŒ‰é’®: Primary / Default / Dashed / Text
- è¡¨å•: 24æ …æ ¼å¸ƒå±€ï¼Œlabel å®½åº¦ 120px
- è¡¨æ ¼: æ–‘é©¬çº¹ï¼Œå¯æ’åºï¼Œåˆ†é¡µ
- å¼¹çª—: å®½åº¦ 600pxï¼Œå±…ä¸­æ˜¾ç¤º

---

## ğŸ”— API é›†æˆ

### API æ¨¡å—åŒ–

```typescript
// api/customer.ts
import request from './request';

export interface Customer {
  id: number;
  name: string;
  phone: string;
  status: string;
}

export const customerApi = {
  getList: (params?: any) => 
    request.get<{ data: Customer[]; total: number }>('/customers', { params }),
    
  getDetail: (id: number) => 
    request.get<Customer>(`/customers/${id}`),
    
  create: (data: Partial<Customer>) => 
    request.post<Customer>('/customers', data),
    
  update: (id: number, data: Partial<Customer>) => 
    request.put<Customer>(`/customers/${id}`, data),
    
  delete: (id: number) => 
    request.delete(`/customers/${id}`),
};
```

---

## ğŸ“± å“åº”å¼è®¾è®¡

### æ–­ç‚¹

```less
// styles/variables.less
@screen-xs: 480px;
@screen-sm: 576px;
@screen-md: 768px;
@screen-lg: 992px;
@screen-xl: 1200px;
@screen-xxl: 1600px;
```

### åª’ä½“æŸ¥è¯¢

```less
.container {
  padding: @spacing-lg;
  
  @media (max-width: @screen-md) {
    padding: @spacing-sm;
  }
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æ¶æ„](./éƒ¨ç½²æ¶æ„.md)
- [ä¼˜åŒ–å»ºè®®](./ä¼˜åŒ–å»ºè®®.md)
- [æŠ€æœ¯æ ˆè¯¦è§£](../TECH_STACK.md)
- [åŠŸèƒ½æ¨¡å—æ¸…å•](../ERP_FEATURES.md)

---

**å‰ç«¯æ¶æ„: ç»„ä»¶åŒ–ã€æ¨¡å—åŒ–ã€å·¥ç¨‹åŒ–** ğŸ¨
