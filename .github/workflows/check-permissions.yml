name: Check Permissions

on:
  pull_request:
    branches: [main, develop]
    types: [opened, synchronize, reopened]

jobs:
  check-permissions:
    name: æƒé™æ£€æŸ¥
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: ðŸ” æ‰§è¡Œæƒé™æ£€æŸ¥
        run: bash .github/scripts/check-permissions.sh
        env:
          GITHUB_ACTOR: ${{ github.actor }}
      
      - name: ðŸ“Š ç”Ÿæˆæ£€æŸ¥æŠ¥å‘Š
        if: always()
        run: |
          echo "## æƒé™æ£€æŸ¥æŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**æäº¤è€…:** @${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "**PRç¼–å·:** #${{ github.event.pull_request.number }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # ç»Ÿè®¡å˜æ›´
          MAIN_CHANGES=$(git diff --name-only origin/main...HEAD | grep "^packages/main/" | wc -l || echo 0)
          
          echo "**å˜æ›´ç»Ÿè®¡:**" >> $GITHUB_STEP_SUMMARY
          echo "- ä¸»åº”ç”¨æ–‡ä»¶: $MAIN_CHANGES" >> $GITHUB_STEP_SUMMARY

